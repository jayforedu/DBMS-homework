# 第3組

組員
===
41043218陳荔群、41043220曾聖傑、41043255蘇于驊、41048110梁詠琳<br>
===
# 題目: 電商平台資料庫設計

---

## 一、應用情境與使用案例（Use Case）

### 🔹 應用情境說明
本系統模擬一個電商平台（如蝦皮），讓賣家能夠上架商品、管理訂單，買家能夠註冊帳號、瀏覽商品、下訂單與付款，並提供評價功能。系統亦包含後台管理員可監控整體平台狀況。

### 🔹 使用者角色
- 買家（Customer）  
- 賣家（Seller）  
- 管理員（Admin）

### 🔹 主要使用案例 Use Cases

| 使用者角色 | 使用案例 |
|------------|-----------|
| 買家       | 註冊/登入、瀏覽商品、加入購物車、下單、付款、查看訂單、評價商品 |
| 賣家       | 註冊/登入、上架商品、修改商品資訊、查看訂單、出貨、查看評論 |
| 管理員     | 查看平台交易記錄、管理用戶帳號、下架不當商品 |

---

## 二、系統需求說明

### Customer（買家）
| 欄位名稱          | 完整性限制說明                                                                      |
| ------------- | ---------------------------------------------------------------------------- |
| `customer_id` | 主鍵。必須唯一且不可為空，用於唯一識別每位買家。                                                     |
| `name`        | 不可為空。應包含至少一個非空白字元。                                                           |
| `email`       | 必須唯一且不可為空。格式需為有效 Email（包含一個 `@` 字元及有效網域名稱，如 `user@example.com`）。不得出現空白或無效格式。 |

### Seller（賣家）
| 欄位名稱        | 完整性限制說明                           |
| ----------- | --------------------------------- |
| `seller_id` | 主鍵。必須唯一且不可為空。                     |
| `name`      | 不可為空，需為具辨識度的名稱。                   |
| `email`     | 必須唯一且不可為空。格式限制同 `Customer.email`。 |

### Admin（管理員）
| 欄位名稱       | 完整性限制說明                           |
| ---------- | --------------------------------- |
| `admin_id` | 主鍵。必須唯一且不可為空。                     |
| `username` | 必須唯一且不可為空。應限制為英數混合字元，不可包含空格或特殊符號。 |

### Product（商品）
| 欄位名稱         | 完整性限制說明                                                            |
| ------------ | ------------------------------------------------------------------ |
| `product_id` | 主鍵。唯一且不可為空。                                                        |
| `name`       | 不可為空。需具明確辨識意義。                                                     |
| `price`      | 必須為正數，且大於 0，不可為負數或零。可為整數或兩位小數。                                     |
| `stock`      | 必須為整數，且不可為負數。                                                      |
| `category`   | 可選欄位。若填寫，應屬於預先定義的分類集合（如 `"electronics"`、`"books"` 等），避免任意輸入造成資料雜亂。 |
| `seller_id`  | 外鍵。需參照 `Seller.seller_id`，不可為空，且必須對應至現有賣家。                         |

### Order（訂單）
| 欄位名稱          | 完整性限制說明                                                             |
| ------------- | ------------------------------------------------------------------- |
| `order_id`    | 主鍵。唯一且不可為空。                                                         |
| `order_date`  | 必須為合理有效的日期。格式為 `YYYY-MM-DD`，日期不得晚於當前系統時間，亦不得早於系統啟用日（避免系統錯誤）。        |
| `status`      | 不可為空。限定值域為下列四種狀態之一：「未付款」、「處理中」、「已出貨」、「已完成」。可使用 ENUM 或 CHECK 條件強制限制。 |
| `customer_id` | 外鍵。需參照 `Customer.customer_id`，不可為空，且必須對應至現有買家。                      |

### OrderItem（訂單項目）
| 欄位名稱                     | 完整性限制說明                           |
| ------------------------ | --------------------------------- |
| `order_id`               | 外鍵。需存在於 `Order.order_id` 中。       |
| `product_id`             | 外鍵。需存在於 `Product.product_id` 中。   |
| `(order_id, product_id)` | 複合主鍵。此組合必須唯一且不可為空。                |
| `quantity`               | 必須為正整數（≥ 1），不得為負數或零，且不得超過商品目前庫存數。 |
| `price_at_purchase`      | 價格需大於 0，保存購買當下的商品價格。此價格不得為負數或零。   |

### Review（商品評價）
| 欄位名稱          | 完整性限制說明                                                       |
| ------------- | ------------------------------------------------------------- |
| `review_id`   | 主鍵。唯一且不可為空。                                                   |
| `product_id`  | 外鍵。需參照 `Product.product_id`，且必須存在。                            |
| `customer_id` | 外鍵。需參照 `Customer.customer_id`，且必須存在。                          |
| `rating`      | 整數，值域限定為 1 至 5。可使用 `CHECK (rating BETWEEN 1 AND 5)` 強制限制評分等級。 |
| `comment`     | 可為空，但若填寫，須具備有效文字內容（不得為純空白或無意義字元）。                             |
| `review_date` | 必須為合理有效日期（格式為 `YYYY-MM-DD`），不得晚於當前系統時間，亦不得早於該商品的訂單完成時間。       |

---

## 三、完整性限制（Integrity Constraints）

1. **主鍵唯一性**：每筆商品、訂單、使用者皆有唯一 ID。
2. **外鍵約束**：
   - 商品屬於某賣家（`Product.seller_id -> Seller.id`）
   - 訂單屬於某買家（`Order.customer_id -> Customer.id`）
3. **庫存限制**：商品庫存數量不得為負。
4. **付款狀態驗證**：僅當付款成功後，訂單狀態才能從「未付款」轉為「處理中」。
5. **評價限制**：使用者只能針對已完成的訂單商品進行評價一次。
6. **Email 唯一性**：每個使用者帳號的 Email 必須唯一。

---

## 四、ER Diagram（實體關係圖）

<div align=center> <img src="er_diagram.png"/> </div>

---

## 五、ER Diagram 詳細說明（實體與關係）

### 1. `Customer`（買家）
| 欄位名稱     | 欄位說明   | 鍵類型 | 參照說明 | 是否可為空 | 
|--------------|------------|--------|----------|-------------|
| customer_id  | 客戶編號   | 主鍵   |          | 否          | 
| name         | 姓名       |        |          | 否          | 
| email        | 電子郵件   | 唯一   |          | 否          | 


### 2. `Seller`（賣家）
| 欄位名稱     | 欄位說明   | 鍵類型 | 參照說明 | 是否可為空 | 
|--------------|------------|--------|----------|-------------|
| seller_id    | 賣家編號   | 主鍵   |          | 否          | 
| name         | 姓名       |        |          | 否          | 
| email        | 電子郵件   | 唯一   |          | 否          | 


### 3. `Admin`（管理員）
| 欄位名稱     | 欄位說明     | 鍵類型 | 參照說明 | 是否可為空 | 
|--------------|--------------|--------|----------|-------------|
| admin_id     | 管理員編號   | 主鍵   |          | 否          | 
| username     | 使用者名稱   | 唯一   |          | 否          | 


### 4. `Product`（商品）
| 欄位名稱     | 欄位說明     | 鍵類型 | 參照說明          | 是否可為空 | 
|--------------|--------------|--------|--------------------|-------------|
| product_id   | 商品編號     | 主鍵   |                    | 否          | 
| name         | 商品名稱     |        |                    | 否          | 
| price        | 價格         |        |                    | 否          | 
| stock        | 庫存數量     |        |                    | 否          | 
| category     | 商品類別     |        |                    | 是          | 
| seller_id    | 賣家編號     | 外鍵   | 參照 Seller.seller_id | 否          | 


### 5. `Order`（訂單）
| 欄位名稱     | 欄位說明     | 鍵類型 | 參照說明               | 是否可為空 |
|--------------|--------------|--------|-------------------------|-------------|
| order_id     | 訂單編號     | 主鍵   |                         | 否          | 
| order_date   | 訂單日期     |        |                         | 否          | 
| status       | 訂單狀態     |        |                         | 否          | 
| customer_id  | 客戶編號     | 外鍵   | 參照 Customer.customer_id | 否          | 


### 6. `OrderItem`（訂單項目）
| 欄位名稱         | 欄位說明     | 鍵類型     | 參照說明                | 是否可為空 | 
|------------------|--------------|------------|--------------------------|-------------|
| order_id         | 訂單編號     | 複合主鍵   | 參照 Order.order_id      | 否          | 
| product_id       | 商品編號     | 複合主鍵   | 參照 Product.product_id  | 否          | 
| quantity         | 購買數量     |            |                          | 否          |
| price_at_purchase| 購買時單價   |            |                          | 否          | 

### 7. `Review`（商品評價）
| 欄位名稱     | 欄位說明     | 鍵類型 | 參照說明                 | 是否可為空 | 
|--------------|--------------|--------|---------------------------|-------------|
| review_id    | 評價編號     | 主鍵   |                           | 否          |
| product_id   | 商品編號     | 外鍵   | 參照 Product.product_id   | 否          | 
| customer_id  | 客戶編號     | 外鍵   | 參照 Customer.customer_id | 否          | 
| rating       | 評分         |        |                           | 否          |
| comment      | 評論內容     |        |                           | 是          | 
| review_date  | 評論日期     |        |                           | 否          | 


---

